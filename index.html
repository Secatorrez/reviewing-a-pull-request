<!DOCTYPE html>
<html>
<head>
  <title>Javascript Tetris</title>
  <style>
    body      { font-family: Helvetica, sans-serif; }
    #tetris   { margin: 1em auto; padding: 1em; border: 4px solid black; border-radius: 10px; background-color: #F8F8F8; }
    #stats    { display: inline-block; vertical-align: top; }
    #canvas   { display: inline-block; vertical-align: top; background: url(texture.jpg); box-shadow: 10px 10px 10px #999; border: 2px solid #333; }
    #menu     { display: inline-block; vertical-align: top; position: relative; }
    #menu p   { margin: 0.5em 0; text-align: center; }
    #menu p a { text-decoration: none; color: black; }
    #upcoming { display: block; margin: 0 auto; background-color: #E0E0E0; }
    #score    { color: blue; font-weight: bold; vertical-align: middle; }
    #rows     { color: blue; font-weight: bold; vertical-align: middle; }
    #stats    { position: absolute; bottom: 0em; right: 1em; }
    @media screen and (min-width:   0px) and (min-height:   0px)  { #tetris { font-size: 0.75em; width: 250px; } #menu { width: 100px; height: 200px; } #upcoming { width:  50px; height:  50px; } #canvas { width: 100px; height: 200px; } } /* 10px chunks */
    @media screen and (min-width: 400px) and (min-height: 400px)  { #tetris { font-size: 1.00em; width: 350px; } #menu { width: 150px; height: 300px; } #upcoming { width:  75px; height:  75px; } #canvas { width: 150px; height: 300px; } } /* 15px chunks */
    @media screen and (min-width: 500px) and (min-height: 500px)  { #tetris { font-size: 1.25em; width: 450px; } #menu { width: 200px; height: 400px; } #upcoming { width: 100px; height: 100px; } #canvas { width: 200px; height: 400px; } } /* 20px chunks */
    @media screen and (min-width: 600px) and (min-height: 600px)  { #tetris { font-size: 1.50em; width: 550px; } #menu { width: 250px; height: 500px; } #upcoming { width: 125px; height: 125px; } #canvas { width: 250px; height: 500px; } } /* 25px chunks */
    @media screen and (min-width: 700px) and (min-height: 700px)  { #tetris { font-size: 1.75em; width: 650px; } #menu { width: 300px; height: 600px; } #upcoming { width: 150px; height: 150px; } #canvas { width: 300px; height: 600px; } } /* 30px chunks */
    @media screen and (min-width: 800px) and (min-height: 800px)  { #tetris { font-size: 2.00em; width: 750px; } #menu { width: 350px; height: 700px; } #upcoming { width: 175px; height: 175px; } #canvas { width: 350px; height: 700px; } } /* 35px chunks */
    @media screen and (min-width: 900px) and (min-height: 900px)  { #tetris { font-size: 2.25em; width: 850px; } #menu { width: 400px; height: 800px; } #upcoming { width: 200px; height: 200px; } #canvas { width: 400px; height: 800px; } } /* 40px chunks */
  </style>
</head>

<body>

  <div id="tetris">
    <div id="menu">
      <p id="start"><a href="javascript:play();">Press Space to Play.</a></p>
      <p><canvas id="upcoming"></canvas></p>
      <p>score <span id="score">00000</span></p>
      <p>rows <span id="rows">0</span></p>
    </div>
    <canvas id="canvas">
      Sorry, this example cannot be run because your browser does not support the &lt;canvas&gt; element
    </canvas>
  </div>

  <script src="stats.js"></script>
  <script>
var _0x3eb5=['resize','pink','0x1e','0x20','0x4','0x2e','length','0x1','random','0x3f','lineWidth','RIGHT','0x23','update','dir','slice','LEFT','strokeStyle','domElement','0x5','0x22','mozRequestAnimationFrame','MAX','blocks','0x6','ESC','max','push','canvas','0x0','keyCode','keydown','0x35','shift','0x37','stats','0x15','black','purple','floor','decrement','0x1d','0xc','innerHTML','MIN','strokeRect','0x33','webkitRequestAnimationFrame','0x18','oRequestAnimationFrame','0x16','0x9','0x2','0x1b','rows','0x38','0x2a','0x17','restore','addEventListener','0x19','0x3','0x30','0x1a','0x34','getContext','fillStyle','orange','0xf','score','0x26','clientHeight','size','0x7','0x1c','0x3c','0x2b','fillRect','splice','0x32','upcoming','0x2c','width','0x36','type','SPACE','DOWN','0xd','requestAnimationFrame','0x14','0xb','red','0x21','getTime','round','0x2d','0xe','0x3d','setTimeout','pow','green','0x13','height','color','start','0x3b','0x10','0x2f','appendChild','0x3e','00000','clientWidth','0x1f','next','menu','0x27','0x29','style','visibility','0x11','0x39','yellow'];(function(_0x1f16f9,_0x3eb57b){var _0x430b78=function(_0x3d4a62){while(--_0x3d4a62){_0x1f16f9['push'](_0x1f16f9['shift']());}};_0x430b78(++_0x3eb57b);}(_0x3eb5,0xe6));var _0x430b=function(_0x1f16f9,_0x3eb57b){_0x1f16f9=_0x1f16f9-0x0;var _0x430b78=_0x3eb5[_0x1f16f9];return _0x430b78;};var _0x49db=[_0x430b('0x34'),_0x430b('0x2d'),_0x430b('0xd'),_0x430b('0x2a'),'hidden',_0x430b('0x31'),'min',_0x430b('0x5c'),'score',_0x430b('0x9'),'clearRect',_0x430b('0x44'),_0x430b('0x23'),_0x430b('0x5'),_0x430b('0x1c'),_0x430b('0x48'),_0x430b('0x56'),_0x430b('0x71'),_0x430b('0x1e'),_0x430b('0x76'),_0x430b('0x64'),'msRequestAnimationFrame',_0x430b('0x6c'),_0x430b('0xa'),_0x430b('0x2c'),_0x430b('0x50'),_0x430b('0x70'),_0x430b('0x3b'),_0x430b('0x27'),_0x430b('0x63'),_0x430b('0x25'),_0x430b('0x60'),_0x430b('0x19'),'court',_0x430b('0x14'),_0x430b('0x1f'),'blue',_0x430b('0x3'),_0x430b('0x1b'),_0x430b('0x35'),_0x430b('0x39'),_0x430b('0xe'),_0x430b('0x49'),_0x430b('0x66'),'translate',_0x430b('0x69'),_0x430b('0x6'),_0x430b('0x36'),_0x430b('0x16'),'domElement',_0x430b('0x75'),'save',_0x430b('0x3a'),_0x430b('0x29'),_0x430b('0x18'),_0x430b('0x6b'),_0x430b('0x62'),_0x430b('0x33'),_0x430b('0x51'),'preventDefault',_0x430b('0x55'),_0x430b('0x24'),_0x430b('0x74'),_0x430b('0x28')];(function(_0x13f972,_0x2c7bee){var _0x20eac4=function(_0x2b8486){while(--_0x2b8486){_0x13f972[_0x430b('0x29')](_0x13f972['shift']());}};_0x20eac4(++_0x2c7bee);}(_0x49db,0x9f));var _0x28b2=function(_0x1678e3,_0xf4f0ce){_0x1678e3=_0x1678e3-0x0;var _0x5ce1e5=_0x49db[_0x1678e3];return _0x5ce1e5;};function get(_0x2fb62e){return document['getElementById'](_0x2fb62e);}function hide(_0x2e9a37){get(_0x2e9a37)[_0x28b2(_0x430b('0x46'))]['visibility']=_0x28b2('0x25');}function show(_0xf68e17){get(_0xf68e17)[_0x28b2(_0x430b('0x46'))][_0x28b2(_0x430b('0x45'))]=null;}function html(_0x55a5db,_0x1fbbf7){get(_0x55a5db)[_0x28b2(_0x430b('0x41'))]=_0x1fbbf7;}function timestamp(){return new Date()[_0x28b2(_0x430b('0x3e'))]();}function random(_0x1dee97,_0x2ff2fe){return _0x1dee97+Math[_0x28b2(_0x430b('0xb'))]()*(_0x2ff2fe-_0x1dee97);}function randomChoice(_0x4de70e){return _0x4de70e[Math[_0x430b('0x6c')](random(0x0,_0x4de70e[_0x28b2('0x3')]-0x1))];}if(!window[_0x28b2(_0x430b('0x38'))]){window[_0x430b('0x66')]=window[_0x430b('0x3d')]||window[_0x28b2(_0x430b('0x6d'))]||window[_0x430b('0x3f')]||window[_0x28b2(_0x430b('0x61'))]||function(_0x299bba,_0xdc2209){window[_0x28b2(_0x430b('0x77'))](_0x299bba,0x3e8/0x3c);};}var KEY={'ESC':0x1b,'SPACE':0x20,'LEFT':0x25,'UP':0x26,'RIGHT':0x27,'DOWN':0x28},DIR={'UP':0x0,'RIGHT':0x1,'DOWN':0x2,'LEFT':0x3,'MIN':0x0,'MAX':0x3},stats=new Stats(),canvas=get(_0x28b2('0x24')),ctx=canvas[_0x430b('0x4f')]('2d'),ucanvas=get(_0x430b('0x5e')),uctx=ucanvas['getContext']('2d'),speed={'start':0.7,'decrement':0.003,'min':0.2},nx=0x14,ny=0x28,nu=0x5;var dx,dy,blocks,actions,playing,paused,dt,current,next,score,vscore,rows,step;var i={'size':0x4,'blocks':[0xf00,0x2222,0xf0,0x4444],'color':_0x28b2(_0x430b('0x21'))};var j={'size':0x3,'blocks':[0x44c0,0x8e00,0x6440,0xe20],'color':_0x28b2(_0x430b('0x1a'))};var l={'size':0x3,'blocks':[0x4460,0xe80,0xc440,0x2e00],'color':_0x430b('0xf')};var o={'size':0x2,'blocks':[0xcc00,0xcc00,0xcc00,0xcc00],'color':_0x28b2(_0x430b('0x6e'))};var s={'size':0x3,'blocks':[0x6c0,0x8c40,0x6c00,0x4620],'color':_0x430b('0x72')};var t={'size':0x3,'blocks':[0xe40,0x4c40,0x4e00,0x4640],'color':_0x28b2(_0x430b('0x43'))};var z={'size':0x3,'blocks':[0xc60,0x4c80,0xc600,0x2640],'color':_0x28b2(_0x430b('0x6a'))};function eachblock(_0x49a3bc,_0x23d69b,_0x185d48,_0xe84199,_0x2eda67){var _0x29dc27,_0x2ae1d2,_0x46872c=0x0,_0x244a83=0x0,_0x592243=_0x49a3bc[_0x28b2(_0x430b('0x17'))][_0xe84199];for(_0x29dc27=0x8000;_0x29dc27>0x0;_0x29dc27=_0x29dc27>>0x1){if(_0x592243&_0x29dc27){_0x2eda67(_0x23d69b+_0x244a83,_0x185d48+_0x46872c);}if(++_0x244a83===0x4){_0x244a83=0x0;++_0x46872c;}}}function occupied(_0x2a5f01,_0x36d012,_0x150a51,_0x3604ce){var _0x468bd2=![];eachblock(_0x2a5f01,_0x36d012,_0x150a51,_0x3604ce,function(_0x23bce0,_0x43dedd){if(_0x23bce0<0x0||_0x23bce0>=nx||_0x43dedd<0x0||_0x43dedd>=ny||getBlock(_0x23bce0,_0x43dedd))_0x468bd2=!![];});return _0x468bd2;}function unoccupied(_0x21cda9,_0x3dd241,_0x537f9e,_0x5b2643){return!occupied(_0x21cda9,_0x3dd241,_0x537f9e,_0x5b2643);}var pieces=[];function randomPiece(){if(pieces[_0x430b('0x14')]==0x0)pieces=[i,i,i,i,j,j,j,j,l,l,l,l,o,o,o,o,s,s,s,s,t,t,t,t,z,z,z,z];var _0x385dd9=pieces[_0x28b2('0x28')](random(0x0,pieces[_0x28b2(_0x430b('0x4b'))]-0x1),0x1)[0x0];return{'type':_0x385dd9,'dir':DIR['UP'],'x':Math[_0x28b2(_0x430b('0x30'))](random(0x0,nx-_0x385dd9[_0x430b('0x56')])),'y':0x0};}function run(){showStats();addEvents();var _0x3e064b=now=timestamp();function _0xf3f8a6(){now=timestamp();update(Math[_0x28b2(_0x430b('0x7'))](0x1,(now-_0x3e064b)/0x3e8));draw();stats[_0x28b2(_0x430b('0x57'))]();_0x3e064b=now;requestAnimationFrame(_0xf3f8a6,canvas);}resize();reset();_0xf3f8a6();}function showStats(){stats[_0x430b('0x20')]['id']=_0x28b2(_0x430b('0x54'));get(_0x28b2(_0x430b('0x52')))[_0x430b('0x0')](stats[_0x28b2('0x12')]);}function addEvents(){document[_0x28b2(_0x430b('0x68'))](_0x28b2(_0x430b('0x22')),keydown,![]);window[_0x28b2(_0x430b('0x68'))](_0x28b2('0xa'),resize,![]);}function resize(_0x485269){canvas[_0x28b2('0x0')]=canvas[_0x28b2(_0x430b('0x26'))];canvas[_0x28b2(_0x430b('0x4'))]=canvas[_0x28b2(_0x430b('0x37'))];ucanvas[_0x28b2(_0x430b('0x2b'))]=ucanvas[_0x28b2(_0x430b('0x26'))];ucanvas[_0x28b2(_0x430b('0x4'))]=ucanvas[_0x28b2(_0x430b('0x37'))];dx=canvas[_0x28b2(_0x430b('0x2b'))]/nx;dy=canvas[_0x430b('0x74')]/ny;invalidate();invalidateNext();}function keydown(_0x2b738c){var _0x18415b=![];if(playing){switch(_0x2b738c[_0x28b2(_0x430b('0xc'))]){case KEY[_0x28b2(_0x430b('0x3c'))]:actions[_0x28b2(_0x430b('0x40'))](DIR[_0x28b2(_0x430b('0x3c'))]);_0x18415b=!![];break;case KEY[_0x28b2(_0x430b('0x15'))]:actions[_0x28b2(_0x430b('0x40'))](DIR[_0x28b2(_0x430b('0x15'))]);_0x18415b=!![];break;case KEY['UP']:actions[_0x28b2('0x16')](DIR['UP']);_0x18415b=!![];break;case KEY[_0x28b2(_0x430b('0x2e'))]:actions[_0x28b2('0x16')](DIR[_0x28b2(_0x430b('0x2e'))]);_0x18415b=!![];break;case KEY[_0x28b2(_0x430b('0x6f'))]:lose();_0x18415b=!![];break;case KEY[_0x28b2(_0x430b('0x1'))]:pause();_0x18415b=!![];break;}}else if(_0x2b738c[_0x430b('0x2c')]==KEY[_0x28b2(_0x430b('0x1'))]){if(paused){restart();_0x18415b=!![];}else{play();_0x18415b=!![];}}if(_0x18415b)_0x2b738c[_0x28b2(_0x430b('0x58'))]();}function play(){hide(_0x430b('0x76'));reset();paused=![];playing=!![];}function pause(){show(_0x28b2(_0x430b('0x4e')));paused=!![];playing=![];}function restart(){hide(_0x430b('0x76'));paused=![];playing=!![];}function lose(){show(_0x28b2(_0x430b('0x4e')));setVisualScore();playing=![];}function setVisualScore(_0x26449a){vscore=_0x26449a||score;invalidateScore();}function setScore(_0x5a36ef){score=_0x5a36ef;setVisualScore(_0x5a36ef);}function addScore(_0x4a7346){score=score+_0x4a7346;}function clearScore(){setScore(0x0);}function clearRows(){setRows(0x0);}function setRows(_0x5cb7c4){rows=_0x5cb7c4;step=Math[_0x28b2(_0x430b('0x11'))](speed[_0x28b2(_0x430b('0x7'))],speed[_0x28b2(_0x430b('0x4e'))]-speed[_0x28b2(_0x430b('0x78'))]*rows);invalidateRows();}function addRows(_0x450235){setRows(rows+_0x450235);}function getBlock(_0xe9eae5,_0x2cb32c){return blocks&&blocks[_0xe9eae5]?blocks[_0xe9eae5][_0x2cb32c]:null;}function setBlock(_0x37b7c3,_0x1476d1,_0x2f84da){blocks[_0x37b7c3]=blocks[_0x37b7c3]||[];blocks[_0x37b7c3][_0x1476d1]=_0x2f84da;invalidate();}function clearBlocks(){blocks=[];invalidate();}function clearActions(){actions=[];}function setCurrentPiece(_0x5af75e){current=_0x5af75e||randomPiece();invalidate();}function setNextPiece(_0x56b707){next=_0x56b707||randomPiece();invalidateNext();}function reset(){dt=0x0;clearActions();clearBlocks();clearRows();clearScore();setCurrentPiece(next);setNextPiece();}function update(_0x1cff33){if(playing){if(vscore<score)setVisualScore(vscore+0x1);handle(actions[_0x430b('0x2f')]());dt=dt+_0x1cff33;if(dt>step){dt=dt-step;drop();}}}function handle(_0x2b138c){switch(_0x2b138c){case DIR[_0x28b2(_0x430b('0x3c'))]:move(DIR[_0x430b('0x1e')]);break;case DIR[_0x28b2(_0x430b('0x15'))]:move(DIR[_0x28b2(_0x430b('0x15'))]);break;case DIR['UP']:rotate();break;case DIR[_0x28b2('0x35')]:drop();break;}}function move(_0x2d7f59){var _0x507933=current['x'],_0x28661f=current['y'];switch(_0x2d7f59){case DIR[_0x28b2(_0x430b('0x15'))]:_0x507933=_0x507933+0x1;break;case DIR[_0x430b('0x1e')]:_0x507933=_0x507933-0x1;break;case DIR[_0x28b2(_0x430b('0x2e'))]:_0x28661f=_0x28661f+0x1;break;}if(unoccupied(current[_0x28b2(_0x430b('0x4a'))],_0x507933,_0x28661f,current[_0x28b2(_0x430b('0x79'))])){current['x']=_0x507933;current['y']=_0x28661f;invalidate();return!![];}else{return![];}}function rotate(){var _0x26b9a7=current[_0x28b2(_0x430b('0x79'))]==DIR[_0x28b2(_0x430b('0x10'))]?DIR[_0x28b2(_0x430b('0x32'))]:current[_0x28b2(_0x430b('0x79'))]+0x1;if(unoccupied(current[_0x430b('0x62')],current['x'],current['y'],_0x26b9a7)){current[_0x28b2(_0x430b('0x79'))]=_0x26b9a7;invalidate();}}function drop(){if(!move(DIR['DOWN'])){addScore(0xa);dropPiece();removeLines();setCurrentPiece(next);setNextPiece(randomPiece());clearActions();if(occupied(current[_0x28b2(_0x430b('0x4a'))],current['x'],current['y'],current[_0x430b('0x1c')])){lose();}}}function dropPiece(){eachblock(current[_0x28b2(_0x430b('0x4a'))],current['x'],current['y'],current[_0x28b2('0x2f')],function(_0x512318,_0x325a61){setBlock(_0x512318,_0x325a61,current[_0x28b2(_0x430b('0x4a'))]);});}function removeLines(){var _0x7cb892,_0x4d2273,_0x1970ab,_0x2942ec=0x0;for(_0x4d2273=ny;_0x4d2273>0x0;--_0x4d2273){_0x1970ab=!![];for(_0x7cb892=0x0;_0x7cb892<nx;++_0x7cb892){if(!getBlock(_0x7cb892,_0x4d2273))_0x1970ab=![];}if(_0x1970ab){removeLine(_0x4d2273);_0x4d2273=_0x4d2273+0x1;_0x2942ec++;}}if(_0x2942ec>0x0){addRows(_0x2942ec);addScore(0xc8*Math[_0x28b2(_0x430b('0x5d'))](0x2,_0x2942ec));}}function removeLine(_0x36c681){var _0x59278e,_0x71cae5;for(_0x71cae5=_0x36c681;_0x71cae5>=0x0;--_0x71cae5){for(_0x59278e=0x0;_0x59278e<nx;++_0x59278e)setBlock(_0x59278e,_0x71cae5,_0x71cae5==0x0?null:getBlock(_0x59278e,_0x71cae5-0x1));}}var invalid={};function invalidate(){invalid[_0x28b2(_0x430b('0x42'))]=!![];}function invalidateNext(){invalid[_0x28b2(_0x430b('0x13'))]=!![];}function invalidateScore(){invalid[_0x430b('0x53')]=!![];}function invalidateRows(){invalid[_0x28b2(_0x430b('0x5f'))]=!![];}function draw(){ctx[_0x28b2(_0x430b('0x67'))]();ctx[_0x28b2(_0x430b('0x47'))]=0x1;ctx[_0x28b2(_0x430b('0x65'))](0.5,0.5);drawCourt();drawNext();drawScore();drawRows();ctx[_0x28b2('0x30')]();}function drawCourt(){if(invalid[_0x28b2('0x2')]){ctx[_0x28b2(_0x430b('0x5a'))](0x0,0x0,canvas[_0x28b2(_0x430b('0x2b'))],canvas[_0x430b('0x74')]);if(playing)drawPiece(ctx,current[_0x28b2('0x19')],current['x'],current['y'],current['dir']);var _0x2ae082,_0x54d680,_0x3ec157;for(_0x54d680=0x0;_0x54d680<ny;_0x54d680++){for(_0x2ae082=0x0;_0x2ae082<nx;_0x2ae082++){if(_0x3ec157=getBlock(_0x2ae082,_0x54d680))drawBlock(ctx,_0x2ae082,_0x54d680,_0x3ec157[_0x430b('0x75')]);}}ctx[_0x430b('0x3b')](0x0,0x0,nx*dx-0x1,ny*dy-0x1);invalid[_0x28b2(_0x430b('0x42'))]=![];}}function drawNext(){if(invalid[_0x430b('0x5')]){var _0x4913f0=(nu-next[_0x28b2(_0x430b('0x4a'))][_0x28b2('0x31')])/0x2;uctx[_0x28b2(_0x430b('0x67'))]();uctx[_0x28b2(_0x430b('0x65'))](0.5,0.5);uctx[_0x28b2(_0x430b('0x5a'))](0x0,0x0,nu*dx,nu*dy);drawPiece(uctx,next[_0x28b2(_0x430b('0x4a'))],_0x4913f0,_0x4913f0,next[_0x28b2(_0x430b('0x79'))]);uctx[_0x28b2(_0x430b('0x12'))]=_0x28b2(_0x430b('0x4d'));uctx[_0x28b2(_0x430b('0x59'))](0x0,0x0,nu*dx-0x1,nu*dy-0x1);uctx[_0x28b2(_0x430b('0x4c'))]();invalid[_0x28b2('0x2e')]=![];}}function drawScore(){if(invalid[_0x28b2(_0x430b('0x8'))]){html(_0x28b2('0x29'),(_0x430b('0x2')+Math[_0x28b2('0x8')](vscore))[_0x430b('0x1d')](-0x5));invalid[_0x430b('0x53')]=![];}}function drawRows(){if(invalid[_0x28b2(_0x430b('0x5f'))]){html(_0x28b2(_0x430b('0x5f')),rows);invalid[_0x28b2(_0x430b('0x5f'))]=![];}}function drawPiece(_0x3647ed,_0x2afe7d,_0x1a7143,_0x1d0bec,_0x29ec6d){eachblock(_0x2afe7d,_0x1a7143,_0x1d0bec,_0x29ec6d,function(_0x2ce355,_0x5893ae){drawBlock(_0x3647ed,_0x2ce355,_0x5893ae,_0x2afe7d[_0x28b2(_0x430b('0x73'))]);});}function drawBlock(_0x2325c9,_0x807870,_0x4ae211,_0x27888c){_0x2325c9[_0x28b2('0x3a')]=_0x27888c;_0x2325c9[_0x430b('0x5b')](_0x807870*dx,_0x4ae211*dy,dx,dy);_0x2325c9[_0x28b2(_0x430b('0x59'))](_0x807870*dx,_0x4ae211*dy,dx,dy);}
    //-------------------------------------------------------------------------
    // FINALLY, lets run the game vvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
    //-------------------------------------------------------------------------

    run();

  </script>

</body>
</html>
