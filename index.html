<!DOCTYPE html>
<html>
<head>
  <title>Javascript Tetris</title>
  <style>
    body      { font-family: Helvetica, sans-serif; }
    #tetris   { margin: 1em auto; padding: 1em; border: 4px solid black; border-radius: 10px; background-color: #F8F8F8; }
    #stats    { display: inline-block; vertical-align: top; }
    #canvas   { display: inline-block; vertical-align: top; background: url(texture.jpg); box-shadow: 10px 10px 10px #999; border: 2px solid #333; }
    #menu     { display: inline-block; vertical-align: top; position: relative; }
    #menu p   { margin: 0.5em 0; text-align: center; }
    #menu p a { text-decoration: none; color: black; }
    #upcoming { display: block; margin: 0 auto; background-color: #E0E0E0; }
    #score    { color: blue; font-weight: bold; vertical-align: middle; }
    #rows     { color: blue; font-weight: bold; vertical-align: middle; }
    #stats    { position: absolute; bottom: 0em; right: 1em; }
    @media screen and (min-width:   0px) and (min-height:   0px)  { #tetris { font-size: 0.75em; width: 250px; } #menu { width: 100px; height: 200px; } #upcoming { width:  50px; height:  50px; } #canvas { width: 100px; height: 200px; } } /* 10px chunks */
    @media screen and (min-width: 400px) and (min-height: 400px)  { #tetris { font-size: 1.00em; width: 350px; } #menu { width: 150px; height: 300px; } #upcoming { width:  75px; height:  75px; } #canvas { width: 150px; height: 300px; } } /* 15px chunks */
    @media screen and (min-width: 500px) and (min-height: 500px)  { #tetris { font-size: 1.25em; width: 450px; } #menu { width: 200px; height: 400px; } #upcoming { width: 100px; height: 100px; } #canvas { width: 200px; height: 400px; } } /* 20px chunks */
    @media screen and (min-width: 600px) and (min-height: 600px)  { #tetris { font-size: 1.50em; width: 550px; } #menu { width: 250px; height: 500px; } #upcoming { width: 125px; height: 125px; } #canvas { width: 250px; height: 500px; } } /* 25px chunks */
    @media screen and (min-width: 700px) and (min-height: 700px)  { #tetris { font-size: 1.75em; width: 650px; } #menu { width: 300px; height: 600px; } #upcoming { width: 150px; height: 150px; } #canvas { width: 300px; height: 600px; } } /* 30px chunks */
    @media screen and (min-width: 800px) and (min-height: 800px)  { #tetris { font-size: 2.00em; width: 750px; } #menu { width: 350px; height: 700px; } #upcoming { width: 175px; height: 175px; } #canvas { width: 350px; height: 700px; } } /* 35px chunks */
    @media screen and (min-width: 900px) and (min-height: 900px)  { #tetris { font-size: 2.25em; width: 850px; } #menu { width: 400px; height: 800px; } #upcoming { width: 200px; height: 200px; } #canvas { width: 400px; height: 800px; } } /* 40px chunks */
  </style>
</head>

<body>

  <div id="tetris">
    <div id="menu">
      <p id="start"><a href="javascript:play();">Press Space to Play.</a></p>
      <p><canvas id="upcoming"></canvas></p>
      <p>score <span id="score">00000</span></p>
      <p>rows <span id="rows">0</span></p>
    </div>
    <canvas id="canvas">
      Sorry, this example cannot be run because your browser does not support the &lt;canvas&gt; element
    </canvas>
  </div>

  <script src="stats.js"></script>
  <script>
var _0x49db=['purple','keydown','yellow','canvas','hidden','stats','min','splice','score','style','clearRect','rows','mozRequestAnimationFrame','next','dir','restore','size','pow','LEFT','start','DOWN','msRequestAnimationFrame','round','visibility','keyCode','fillStyle','setTimeout','strokeRect','ESC','SPACE','blocks','width','RIGHT','court','length','strokeStyle','blue','clientWidth','update','floor','innerHTML','resize','addEventListener','requestAnimationFrame','translate','red','menu','decrement','random','domElement','color','save','MIN','push','lineWidth','getTime','type','black','orange','preventDefault','clientHeight','MAX','height','max'];(function(_0xe1c6ec,_0x49db6b){var _0x28b217=function(_0x561ffe){while(--_0x561ffe){_0xe1c6ec['push'](_0xe1c6ec['shift']());}};_0x28b217(++_0x49db6b);}(_0x49db,0x9f));var _0x28b2=function(_0xe1c6ec,_0x49db6b){_0xe1c6ec=_0xe1c6ec-0x0;var _0x28b217=_0x49db[_0xe1c6ec];return _0x28b217;};function get(_0x311e18){return document['getElementById'](_0x311e18);}function hide(_0x2abcc7){get(_0x2abcc7)[_0x28b2('0x2a')]['visibility']=_0x28b2('0x25');}function show(_0x22662f){get(_0x22662f)[_0x28b2('0x2a')][_0x28b2('0x38')]=null;}function html(_0x380d2f,_0x4f063c){get(_0x380d2f)[_0x28b2('0x9')]=_0x4f063c;}function timestamp(){return new Date()[_0x28b2('0x18')]();}function random(_0x1b1f4a,_0x5326b5){return _0x1b1f4a+Math[_0x28b2('0x11')]()*(_0x5326b5-_0x1b1f4a);}function randomChoice(_0x283238){return _0x283238[Math['round'](random(0x0,_0x283238[_0x28b2('0x3')]-0x1))];}if(!window[_0x28b2('0xc')]){window['requestAnimationFrame']=window['webkitRequestAnimationFrame']||window[_0x28b2('0x2d')]||window['oRequestAnimationFrame']||window[_0x28b2('0x36')]||function(_0x3e28d5,_0x47b18f){window[_0x28b2('0x3b')](_0x3e28d5,0x3e8/0x3c);};}var KEY={'ESC':0x1b,'SPACE':0x20,'LEFT':0x25,'UP':0x26,'RIGHT':0x27,'DOWN':0x28},DIR={'UP':0x0,'RIGHT':0x1,'DOWN':0x2,'LEFT':0x3,'MIN':0x0,'MAX':0x3},stats=new Stats(),canvas=get(_0x28b2('0x24')),ctx=canvas['getContext']('2d'),ucanvas=get('upcoming'),uctx=ucanvas['getContext']('2d'),speed={'start':0.7,'decrement':0.003,'min':0.2},nx=0x14,ny=0x28,nu=0x5;var dx,dy,blocks,actions,playing,paused,dt,current,next,score,vscore,rows,step;var i={'size':0x4,'blocks':[0xf00,0x2222,0xf0,0x4444],'color':_0x28b2('0x5')};var j={'size':0x3,'blocks':[0x44c0,0x8e00,0x6440,0xe20],'color':_0x28b2('0x23')};var l={'size':0x3,'blocks':[0x4460,0xe80,0xc440,0x2e00],'color':'pink'};var o={'size':0x2,'blocks':[0xcc00,0xcc00,0xcc00,0xcc00],'color':_0x28b2('0xe')};var s={'size':0x3,'blocks':[0x6c0,0x8c40,0x6c00,0x4620],'color':'green'};var t={'size':0x3,'blocks':[0xe40,0x4c40,0x4e00,0x4640],'color':_0x28b2('0x1b')};var z={'size':0x3,'blocks':[0xc60,0x4c80,0xc600,0x2640],'color':_0x28b2('0x21')};function eachblock(_0x26190d,_0xae5396,_0x3418ec,_0x1fbffb,_0x3b7d1b){var _0x2b4626,_0x1a716a,_0x519452=0x0,_0x1048b6=0x0,_0x9e62a=_0x26190d[_0x28b2('0x3f')][_0x1fbffb];for(_0x2b4626=0x8000;_0x2b4626>0x0;_0x2b4626=_0x2b4626>>0x1){if(_0x9e62a&_0x2b4626){_0x3b7d1b(_0xae5396+_0x1048b6,_0x3418ec+_0x519452);}if(++_0x1048b6===0x4){_0x1048b6=0x0;++_0x519452;}}}function occupied(_0x21e557,_0x506e3a,_0x503d27,_0x3cc00f){var _0x1cc618=![];eachblock(_0x21e557,_0x506e3a,_0x503d27,_0x3cc00f,function(_0x3c7be6,_0x144e8a){if(_0x3c7be6<0x0||_0x3c7be6>=nx||_0x144e8a<0x0||_0x144e8a>=ny||getBlock(_0x3c7be6,_0x144e8a))_0x1cc618=!![];});return _0x1cc618;}function unoccupied(_0x5b7e07,_0x31c1d0,_0x1d3147,_0x17acb7){return!occupied(_0x5b7e07,_0x31c1d0,_0x1d3147,_0x17acb7);}var pieces=[];function randomPiece(){if(pieces['length']==0x0)pieces=[i,i,i,i,j,j,j,j,l,l,l,l,o,o,o,o,s,s,s,s,t,t,t,t,z,z,z,z];var _0x4e2fa2=pieces[_0x28b2('0x28')](random(0x0,pieces[_0x28b2('0x3')]-0x1),0x1)[0x0];return{'type':_0x4e2fa2,'dir':DIR['UP'],'x':Math[_0x28b2('0x37')](random(0x0,nx-_0x4e2fa2['size'])),'y':0x0};}function run(){showStats();addEvents();var _0x2de021=now=timestamp();function _0x1beac1(){now=timestamp();update(Math[_0x28b2('0x27')](0x1,(now-_0x2de021)/0x3e8));draw();stats[_0x28b2('0x7')]();_0x2de021=now;requestAnimationFrame(_0x1beac1,canvas);}resize();reset();_0x1beac1();}function showStats(){stats['domElement']['id']=_0x28b2('0x26');get(_0x28b2('0xf'))['appendChild'](stats[_0x28b2('0x12')]);}function addEvents(){document[_0x28b2('0xb')](_0x28b2('0x22'),keydown,![]);window[_0x28b2('0xb')](_0x28b2('0xa'),resize,![]);}function resize(_0x2231c3){canvas[_0x28b2('0x0')]=canvas[_0x28b2('0x6')];canvas[_0x28b2('0x1f')]=canvas[_0x28b2('0x1d')];ucanvas[_0x28b2('0x0')]=ucanvas[_0x28b2('0x6')];ucanvas[_0x28b2('0x1f')]=ucanvas[_0x28b2('0x1d')];dx=canvas[_0x28b2('0x0')]/nx;dy=canvas['height']/ny;invalidate();invalidateNext();}function keydown(_0x545803){var _0x27aaf5=![];if(playing){switch(_0x545803[_0x28b2('0x39')]){case KEY[_0x28b2('0x33')]:actions[_0x28b2('0x16')](DIR[_0x28b2('0x33')]);_0x27aaf5=!![];break;case KEY[_0x28b2('0x1')]:actions[_0x28b2('0x16')](DIR[_0x28b2('0x1')]);_0x27aaf5=!![];break;case KEY['UP']:actions[_0x28b2('0x16')](DIR['UP']);_0x27aaf5=!![];break;case KEY[_0x28b2('0x35')]:actions[_0x28b2('0x16')](DIR[_0x28b2('0x35')]);_0x27aaf5=!![];break;case KEY[_0x28b2('0x3d')]:lose();_0x27aaf5=!![];break;case KEY[_0x28b2('0x3e')]:pause();_0x27aaf5=!![];break;}}else if(_0x545803['keyCode']==KEY[_0x28b2('0x3e')]){if(paused){restart();_0x27aaf5=!![];}else{play();_0x27aaf5=!![];}}if(_0x27aaf5)_0x545803[_0x28b2('0x1c')]();}function play(){hide('start');reset();paused=![];playing=!![];}function pause(){show(_0x28b2('0x34'));paused=!![];playing=![];}function restart(){hide('start');paused=![];playing=!![];}function lose(){show(_0x28b2('0x34'));setVisualScore();playing=![];}function setVisualScore(_0x591cac){vscore=_0x591cac||score;invalidateScore();}function setScore(_0x3b1a4c){score=_0x3b1a4c;setVisualScore(_0x3b1a4c);}function addScore(_0x348212){score=score+_0x348212;}function clearScore(){setScore(0x0);}function clearRows(){setRows(0x0);}function setRows(_0x168a5a){rows=_0x168a5a;step=Math[_0x28b2('0x20')](speed[_0x28b2('0x27')],speed[_0x28b2('0x34')]-speed[_0x28b2('0x10')]*rows);invalidateRows();}function addRows(_0x324e67){setRows(rows+_0x324e67);}function getBlock(_0x553659,_0x56b5cb){return blocks&&blocks[_0x553659]?blocks[_0x553659][_0x56b5cb]:null;}function setBlock(_0x1b644f,_0x4137aa,_0x396764){blocks[_0x1b644f]=blocks[_0x1b644f]||[];blocks[_0x1b644f][_0x4137aa]=_0x396764;invalidate();}function clearBlocks(){blocks=[];invalidate();}function clearActions(){actions=[];}function setCurrentPiece(_0x3027a7){current=_0x3027a7||randomPiece();invalidate();}function setNextPiece(_0x2a4ce4){next=_0x2a4ce4||randomPiece();invalidateNext();}function reset(){dt=0x0;clearActions();clearBlocks();clearRows();clearScore();setCurrentPiece(next);setNextPiece();}function update(_0x5675da){if(playing){if(vscore<score)setVisualScore(vscore+0x1);handle(actions['shift']());dt=dt+_0x5675da;if(dt>step){dt=dt-step;drop();}}}function handle(_0x55aad7){switch(_0x55aad7){case DIR[_0x28b2('0x33')]:move(DIR['LEFT']);break;case DIR[_0x28b2('0x1')]:move(DIR[_0x28b2('0x1')]);break;case DIR['UP']:rotate();break;case DIR[_0x28b2('0x35')]:drop();break;}}function move(_0x11ff44){var _0x1babc4=current['x'],_0x1765ee=current['y'];switch(_0x11ff44){case DIR[_0x28b2('0x1')]:_0x1babc4=_0x1babc4+0x1;break;case DIR['LEFT']:_0x1babc4=_0x1babc4-0x1;break;case DIR[_0x28b2('0x35')]:_0x1765ee=_0x1765ee+0x1;break;}if(unoccupied(current[_0x28b2('0x19')],_0x1babc4,_0x1765ee,current[_0x28b2('0x2f')])){current['x']=_0x1babc4;current['y']=_0x1765ee;invalidate();return!![];}else{return![];}}function rotate(){var _0x5c5849=current[_0x28b2('0x2f')]==DIR[_0x28b2('0x1e')]?DIR[_0x28b2('0x15')]:current[_0x28b2('0x2f')]+0x1;if(unoccupied(current['type'],current['x'],current['y'],_0x5c5849)){current[_0x28b2('0x2f')]=_0x5c5849;invalidate();}}function drop(){if(!move(DIR['DOWN'])){addScore(0xa);dropPiece();removeLines();setCurrentPiece(next);setNextPiece(randomPiece());clearActions();if(occupied(current[_0x28b2('0x19')],current['x'],current['y'],current['dir'])){lose();}}}function dropPiece(){eachblock(current[_0x28b2('0x19')],current['x'],current['y'],current[_0x28b2('0x2f')],function(_0x16cfca,_0x3d309f){setBlock(_0x16cfca,_0x3d309f,current[_0x28b2('0x19')]);});}function removeLines(){var _0x4c42c6,_0x41422c,_0x3563cf,_0x13b7d0=0x0;for(_0x41422c=ny;_0x41422c>0x0;--_0x41422c){_0x3563cf=!![];for(_0x4c42c6=0x0;_0x4c42c6<nx;++_0x4c42c6){if(!getBlock(_0x4c42c6,_0x41422c))_0x3563cf=![];}if(_0x3563cf){removeLine(_0x41422c);_0x41422c=_0x41422c+0x1;_0x13b7d0++;}}if(_0x13b7d0>0x0){addRows(_0x13b7d0);addScore(0xc8*Math[_0x28b2('0x32')](0x2,_0x13b7d0));}}function removeLine(_0x65168d){var _0x3505d6,_0x1c9aa9;for(_0x1c9aa9=_0x65168d;_0x1c9aa9>=0x0;--_0x1c9aa9){for(_0x3505d6=0x0;_0x3505d6<nx;++_0x3505d6)setBlock(_0x3505d6,_0x1c9aa9,_0x1c9aa9==0x0?null:getBlock(_0x3505d6,_0x1c9aa9-0x1));}}var invalid={};function invalidate(){invalid[_0x28b2('0x2')]=!![];}function invalidateNext(){invalid[_0x28b2('0x2e')]=!![];}function invalidateScore(){invalid['score']=!![];}function invalidateRows(){invalid[_0x28b2('0x2c')]=!![];}function draw(){ctx[_0x28b2('0x14')]();ctx[_0x28b2('0x17')]=0x1;ctx[_0x28b2('0xd')](0.5,0.5);drawCourt();drawNext();drawScore();drawRows();ctx[_0x28b2('0x30')]();}function drawCourt(){if(invalid[_0x28b2('0x2')]){ctx[_0x28b2('0x2b')](0x0,0x0,canvas[_0x28b2('0x0')],canvas['height']);if(playing)drawPiece(ctx,current[_0x28b2('0x19')],current['x'],current['y'],current['dir']);var _0xc63621,_0x2fe203,_0x1560af;for(_0x2fe203=0x0;_0x2fe203<ny;_0x2fe203++){for(_0xc63621=0x0;_0xc63621<nx;_0xc63621++){if(_0x1560af=getBlock(_0xc63621,_0x2fe203))drawBlock(ctx,_0xc63621,_0x2fe203,_0x1560af['color']);}}ctx['strokeRect'](0x0,0x0,nx*dx-0x1,ny*dy-0x1);invalid[_0x28b2('0x2')]=![];}}function drawNext(){if(invalid['next']){var _0xda7ce9=(nu-next[_0x28b2('0x19')][_0x28b2('0x31')])/0x2;uctx[_0x28b2('0x14')]();uctx[_0x28b2('0xd')](0.5,0.5);uctx[_0x28b2('0x2b')](0x0,0x0,nu*dx,nu*dy);drawPiece(uctx,next[_0x28b2('0x19')],_0xda7ce9,_0xda7ce9,next[_0x28b2('0x2f')]);uctx[_0x28b2('0x4')]=_0x28b2('0x1a');uctx[_0x28b2('0x3c')](0x0,0x0,nu*dx-0x1,nu*dy-0x1);uctx[_0x28b2('0x30')]();invalid[_0x28b2('0x2e')]=![];}}function drawScore(){if(invalid[_0x28b2('0x29')]){html(_0x28b2('0x29'),('00000'+Math[_0x28b2('0x8')](vscore))['slice'](-0x5));invalid['score']=![];}}function drawRows(){if(invalid[_0x28b2('0x2c')]){html(_0x28b2('0x2c'),rows);invalid[_0x28b2('0x2c')]=![];}}function drawPiece(_0x5a4262,_0x264f90,_0x2023a8,_0x75836d,_0x514c41){eachblock(_0x264f90,_0x2023a8,_0x75836d,_0x514c41,function(_0x4c52d4,_0x5e251a){drawBlock(_0x5a4262,_0x4c52d4,_0x5e251a,_0x264f90[_0x28b2('0x13')]);});}function drawBlock(_0xb27fe0,_0x3fda1a,_0x2f1a87,_0x489c9b){_0xb27fe0[_0x28b2('0x3a')]=_0x489c9b;_0xb27fe0['fillRect'](_0x3fda1a*dx,_0x2f1a87*dy,dx,dy);_0xb27fe0[_0x28b2('0x3c')](_0x3fda1a*dx,_0x2f1a87*dy,dx,dy);}
    //-------------------------------------------------------------------------
    // FINALLY, lets run the game
    //-------------------------------------------------------------------------

    run();

  </script>

</body>
</html>
